<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>è¯¡è¯è¿ç¯‡</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif;background:linear-gradient(180deg,#0a0020,#1a0a4e,#0a0020);color:#e0d0ff;min-height:100vh;overflow-x:hidden}
.header{text-align:center;padding:16px 8px 8px}
.header h1{font-size:1.8em;background:linear-gradient(90deg,#c084fc,#60a5fa,#c084fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:4px}
.header .sub{font-size:.75em;color:#7c6aaa;margin-top:4px}
.info-bar{display:flex;justify-content:center;gap:10px;padding:8px;font-size:.75em;flex-wrap:wrap}
.info-bar span{background:rgba(100,60,200,.15);padding:3px 10px;border-radius:10px;border:1px solid rgba(139,92,246,.25);color:#a78bfa}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:8px 12px;max-width:400px;margin:0 auto}
.card{position:relative;perspective:800px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;aspect-ratio:10/13}
.card-inner{position:relative;width:100%;height:100%;transition:transform .6s;-webkit-transform-style:preserve-3d;transform-style:preserve-3d}
.card.flipped .card-inner{transform:rotateY(180deg)}
.card-front,.card-back{position:absolute;top:0;left:0;width:100%;height:100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 6px}
.card-front{background:linear-gradient(145deg,rgba(80,40,140,.7),rgba(50,20,90,.85));border:2px solid rgba(120,70,200,.35)}
.card-back{background:linear-gradient(145deg,rgba(30,50,120,.8),rgba(20,30,80,.9));border:2px solid rgba(60,130,246,.35);transform:rotateY(180deg)}
.card .pos{position:absolute;top:4px;left:6px;font-size:.55em;color:rgba(200,180,255,.5);font-weight:bold;z-index:2}
.card .ava{width:64px;height:64px;border-radius:50%;overflow:hidden;border:2px solid rgba(200,180,255,.3);flex-shrink:0}
.card .ava svg{display:block;width:100%;height:100%}
.card .nm{font-size:.8em;font-weight:bold;color:#e8e0ff;margin-top:4px}
.card .role-tag{font-size:.6em;padding:2px 8px;border-radius:6px;display:inline-block;margin:4px 0}
.role-wolf{background:rgba(239,68,68,.2);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.role-guard{background:rgba(56,189,248,.2);color:#38bdf8;border:1px solid rgba(56,189,248,.3)}
.role-witch{background:rgba(192,132,252,.2);color:#c084fc;border:1px solid rgba(192,132,252,.3)}
.role-seer{background:rgba(251,191,36,.2);color:#fbbf24;border:1px solid rgba(251,191,36,.3)}
.role-villager{background:rgba(74,222,128,.15);color:#4ade80;border:1px solid rgba(74,222,128,.25)}
.card .clue{font-size:.6em;color:#ddd0ff;margin-top:4px;line-height:1.3;padding:3px 4px;background:rgba(0,0,0,.25);border-radius:4px;text-align:center}
.card.selected .card-front{border-color:#22c55e!important;box-shadow:0 0 15px rgba(34,197,94,.4)}
.actions{text-align:center;padding:12px 8px 24px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn{padding:10px 24px;border:none;border-radius:20px;font-size:.9em;font-weight:bold;cursor:pointer;transition:all .2s}
.btn-vote{background:linear-gradient(135deg,#7c3aed,#6d28d9);color:#fff}
.btn-vote:disabled{opacity:.4}
.btn-new{background:rgba(100,60,200,.2);color:#a78bfa;border:1px solid rgba(139,92,246,.3)}
.btn:active{transform:scale(.95)}
.result{text-align:center;padding:8px;font-size:1.1em;font-weight:bold;min-height:2em}
.result .win{color:#4ade80}
.result .lose{color:#ef4444}
.conclusion{text-align:center;font-size:1.2em;font-weight:bold;color:#fbbf24;padding:8px 12px;min-height:1.5em}
</style>
</head>
<body>
<div class="header">
<h1>ğŸº è¯¡è¯è¿ç¯‡</h1>
<div class="sub">ç¿»å¼€å¡ç‰‡ Â· æ¨ç†çœŸç›¸ Â· æ‰¾å‡ºç‹¼äºº</div>
</div>
<div class="info-bar" id="infoBar"></div>
<div class="grid" id="grid"></div>
<div class="conclusion" id="conclusion"></div>
<div class="actions">
<button class="btn btn-vote" id="voteBtn" disabled onclick="vote()">ğŸ—³ï¸ æŠ•ç¥¨å¤„å†³</button>
<button class="btn btn-new" onclick="newGame()">ğŸ”„ æ–°æ¸¸æˆ</button>
</div>
<div class="result" id="result"></div>
<script>
const NAMES=['é©¬å°è…¾','é™ˆè€æ¹¿','èŒƒå°è½©','ç‹å†°å†°','è’‹ä¸‰å²','æ›¾å°è´¤','å¼ å°ç¿ ','é‡‘å°èŒ','ç”„è¿ªå¸…','å‘¨æ˜Ÿæ˜Ÿ','åˆ˜åä»”','è’‹ä¸é€š'];
const GENDERS=['m','m','f','f','f','m','f','f','m','m','m','m'];
const AVATARS=[
// 0 é©¬å°è…¾ - ç”·ï¼Œå•†åŠ¡çŸ­å‘ï¼Œæˆ´çœ¼é•œï¼Œè‡ªä¿¡å¾®ç¬‘
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#4a90d9"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#fddcb5"/>
<path d="M24 42 Q24 16 50 13 Q76 16 76 42 L73 34 Q70 20 50 18 Q30 20 27 34Z" fill="#2c1810"/>
<rect x="30" y="46" width="16" height="10" rx="5" fill="none" stroke="#555" stroke-width="1.8"/>
<rect x="54" y="46" width="16" height="10" rx="5" fill="none" stroke="#555" stroke-width="1.8"/>
<line x1="46" y1="51" x2="54" y2="51" stroke="#555" stroke-width="1.5"/>
<circle cx="38" cy="51" r="2.5" fill="#2c1810"/><circle cx="62" cy="51" r="2.5" fill="#2c1810"/>
<circle cx="39" cy="50" r="0.8" fill="#fff"/><circle cx="63" cy="50" r="0.8" fill="#fff"/>
<path d="M43 67 Q50 73 57 67" stroke="#c0392b" stroke-width="2" fill="#e07070"/>
<ellipse cx="30" cy="60" rx="5" ry="3" fill="#f5b8a0" opacity="0.5"/>
<ellipse cx="70" cy="60" rx="5" ry="3" fill="#f5b8a0" opacity="0.5"/>
</svg>`,
// 1 é™ˆè€æ¹¿ - ç”·ï¼Œæ–‡è‰ºä¸­åˆ†ï¼Œå°èƒ¡å­ï¼Œç¿æ™º
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#6c5ce7"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#f5c5a3"/>
<path d="M24 44 Q24 14 50 11 Q76 14 76 44 L73 36 Q70 20 50 18 Q30 20 27 36Z" fill="#4a2c17"/>
<path d="M50 14 L50 38" stroke="#f5c5a3" stroke-width="2"/>
<circle cx="38" cy="50" r="3" fill="#333"/><circle cx="62" cy="50" r="3" fill="#333"/>
<circle cx="39" cy="49" r="1" fill="#fff"/><circle cx="63" cy="49" r="1" fill="#fff"/>
<path d="M36 44 L42 43" stroke="#4a2c17" stroke-width="2.2" stroke-linecap="round"/>
<path d="M58 43 L64 44" stroke="#4a2c17" stroke-width="2.2" stroke-linecap="round"/>
<path d="M42 63 Q46 60 50 63 Q54 60 58 63" stroke="#5a3a20" stroke-width="1.5" fill="none"/>
<path d="M44 68 Q50 72 56 68" stroke="#333" stroke-width="1.8" fill="none"/>
</svg>`,
// 2 èŒƒå°è½© - å¥³ï¼Œé•¿å·å‘ï¼Œå¤§çœ¼ç›ï¼Œç”œç¾
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#fd79a8"/>
<ellipse cx="50" cy="62" rx="27" ry="29" fill="#fddcb5"/>
<path d="M20 48 Q20 12 50 9 Q80 12 80 48 L78 36 Q75 16 50 14 Q25 16 22 36Z" fill="#8b4513"/>
<path d="M20 46 Q16 68 22 88" stroke="#8b4513" stroke-width="9" fill="none" stroke-linecap="round"/>
<path d="M80 46 Q84 68 78 88" stroke="#8b4513" stroke-width="9" fill="none" stroke-linecap="round"/>
<path d="M22 60 Q18 72 24 82" stroke="#8b4513" stroke-width="6" fill="none" stroke-linecap="round"/>
<path d="M78 60 Q82 72 76 82" stroke="#8b4513" stroke-width="6" fill="none" stroke-linecap="round"/>
<ellipse cx="38" cy="50" rx="4" ry="4.5" fill="#fff"/><ellipse cx="62" cy="50" rx="4" ry="4.5" fill="#fff"/>
<circle cx="38" cy="50" r="2.8" fill="#5b3cc4"/><circle cx="62" cy="50" r="2.8" fill="#5b3cc4"/>
<circle cx="39" cy="49" r="1.2" fill="#fff"/><circle cx="63" cy="49" r="1.2" fill="#fff"/>
<path d="M34 43 Q38 41 42 43" stroke="#8b4513" stroke-width="1.8" fill="none"/>
<path d="M58 43 Q62 41 66 43" stroke="#8b4513" stroke-width="1.8" fill="none"/>
<path d="M44 67 Q50 72 56 67" stroke="#e07070" stroke-width="2" fill="#ff9999"/>
<circle cx="32" cy="58" r="4" fill="#ffb3b3" opacity="0.4"/>
<circle cx="68" cy="58" r="4" fill="#ffb3b3" opacity="0.4"/>
</svg>`,
// 3 ç‹å†°å†° - å¥³ï¼Œé½åˆ˜æµ·çŸ­å‘ï¼Œæ¸…çº¯ï¼Œé…’çª
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#00b894"/>
<ellipse cx="50" cy="62" rx="27" ry="29" fill="#fddcb5"/>
<path d="M22 46 Q22 14 50 11 Q78 14 78 46 L76 36 Q73 18 50 16 Q27 18 24 36Z" fill="#1a1a2e"/>
<rect x="26" y="32" width="48" height="12" rx="2" fill="#1a1a2e"/>
<path d="M22 44 Q18 62 22 78" stroke="#1a1a2e" stroke-width="8" fill="none" stroke-linecap="round"/>
<path d="M78 44 Q82 62 78 78" stroke="#1a1a2e" stroke-width="8" fill="none" stroke-linecap="round"/>
<circle cx="38" cy="52" r="3" fill="#333"/><circle cx="62" cy="52" r="3" fill="#333"/>
<circle cx="39" cy="51" r="1" fill="#fff"/><circle cx="63" cy="51" r="1" fill="#fff"/>
<path d="M44 68 Q50 74 56 68" stroke="#e07070" stroke-width="2" fill="#ff9999"/>
<circle cx="40" cy="68" r="1.5" fill="#ffb3b3" opacity="0.6"/>
<circle cx="60" cy="68" r="1.5" fill="#ffb3b3" opacity="0.6"/>
<ellipse cx="31" cy="59" rx="4" ry="3" fill="#ffb3b3" opacity="0.35"/>
<ellipse cx="69" cy="59" rx="4" ry="3" fill="#ffb3b3" opacity="0.35"/>
</svg>`,
// 4 è’‹ä¸‰å² - å¥³ï¼ŒåŒé©¬å°¾ï¼Œæ´»æ³¼ï¼ŒåèˆŒå¤´
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#fdcb6e"/>
<ellipse cx="50" cy="62" rx="27" ry="29" fill="#fddcb5"/>
<path d="M24 46 Q24 16 50 13 Q76 16 76 46 L73 36 Q70 20 50 18 Q30 20 27 36Z" fill="#d4a574"/>
<circle cx="18" cy="30" r="10" fill="#d4a574"/><circle cx="82" cy="30" r="10" fill="#d4a574"/>
<path d="M18 40 Q18 55 16 70" stroke="#d4a574" stroke-width="7" fill="none" stroke-linecap="round"/>
<path d="M82 40 Q82 55 84 70" stroke="#d4a574" stroke-width="7" fill="none" stroke-linecap="round"/>
<circle cx="18" cy="28" r="3" fill="#ff6b6b"/>
<circle cx="82" cy="28" r="3" fill="#ff6b6b"/>
<circle cx="38" cy="50" r="3.5" fill="#333"/><circle cx="62" cy="50" r="3.5" fill="#333"/>
<circle cx="39" cy="49" r="1.2" fill="#fff"/><circle cx="63" cy="49" r="1.2" fill="#fff"/>
<path d="M44 66 Q50 73 56 66" stroke="#e07070" stroke-width="2" fill="#ff9999"/>
<ellipse cx="50" cy="72" rx="4" ry="3" fill="#ff7070"/>
<ellipse cx="31" cy="58" rx="5" ry="3" fill="#ffb3b3" opacity="0.45"/>
<ellipse cx="69" cy="58" rx="5" ry="3" fill="#ffb3b3" opacity="0.45"/>
</svg>`,
// 5 æ›¾å°è´¤ - ç”·ï¼Œååˆ†åˆ˜æµ·ï¼Œå¸…æ°”ï¼Œåç¬‘
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#e17055"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#f5c5a3"/>
<path d="M24 44 Q24 14 50 11 Q76 14 76 44 L73 34 Q70 18 50 16 Q30 18 27 34Z" fill="#2c1810"/>
<path d="M26 40 Q30 28 50 30 Q38 26 26 36Z" fill="#2c1810"/>
<circle cx="38" cy="50" r="2.8" fill="#333"/><circle cx="62" cy="50" r="2.8" fill="#333"/>
<circle cx="39" cy="49" r="0.9" fill="#fff"/><circle cx="63" cy="49" r="0.9" fill="#fff"/>
<path d="M34 44 L43 46" stroke="#2c1810" stroke-width="2.2" stroke-linecap="round"/>
<path d="M57 46 L66 44" stroke="#2c1810" stroke-width="2.2" stroke-linecap="round"/>
<path d="M42 67 Q50 72 58 65" stroke="#333" stroke-width="2" fill="none"/>
<path d="M56 65 Q58 64 60 65" stroke="#333" stroke-width="1.2" fill="none"/>
</svg>`,
// 6 å¼ å°ç¿  - å¥³ï¼Œä¸¸å­å¤´ï¼Œæ¸©æŸ”ï¼Œå¼¯å¼¯çœ¼
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#a29bfe"/>
<ellipse cx="50" cy="62" rx="27" ry="29" fill="#fddcb5"/>
<path d="M24 48 Q24 18 50 15 Q76 18 76 48 L73 38 Q70 22 50 20 Q30 22 27 38Z" fill="#2c1810"/>
<circle cx="50" cy="12" r="11" fill="#2c1810"/>
<line x1="48" y1="1" x2="52" y2="5" stroke="#ff6b6b" stroke-width="2"/>
<line x1="52" y1="1" x2="48" y2="5" stroke="#ff6b6b" stroke-width="2"/>
<path d="M34 50 Q38 54 42 50" stroke="#333" stroke-width="2" fill="none"/>
<path d="M58 50 Q62 54 66 50" stroke="#333" stroke-width="2" fill="none"/>
<path d="M44 67 Q50 72 56 67" stroke="#e07070" stroke-width="2" fill="#ff9999"/>
<ellipse cx="31" cy="57" rx="4" ry="3" fill="#ffb3b3" opacity="0.4"/>
<ellipse cx="69" cy="57" rx="4" ry="3" fill="#ffb3b3" opacity="0.4"/>
</svg>`,
// 7 é‡‘å°èŒ - å¥³ï¼Œæ³¢æ³¢å¤´ï¼ŒçŒ«è€³å‘é¥°ï¼Œå–èŒ
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#fab1a0"/>
<ellipse cx="50" cy="62" rx="27" ry="29" fill="#fddcb5"/>
<path d="M22 50 Q22 16 50 13 Q78 16 78 50 L76 40 Q73 20 50 18 Q27 20 24 40Z" fill="#c0392b"/>
<path d="M22 48 L22 70" stroke="#c0392b" stroke-width="10" fill="none" stroke-linecap="round"/>
<path d="M78 48 L78 70" stroke="#c0392b" stroke-width="10" fill="none" stroke-linecap="round"/>
<path d="M28 28 L22 12 L38 24Z" fill="#c0392b"/>
<path d="M72 28 L78 12 L62 24Z" fill="#c0392b"/>
<path d="M30 18 L26 14 L36 22Z" fill="#ffb3b3"/>
<path d="M70 18 L74 14 L64 22Z" fill="#ffb3b3"/>
<circle cx="38" cy="52" r="3.5" fill="#333"/><circle cx="62" cy="52" r="3.5" fill="#333"/>
<circle cx="39" cy="51" r="1.3" fill="#fff"/><circle cx="63" cy="51" r="1.3" fill="#fff"/>
<path d="M46 67 Q50 64 54 67" stroke="#333" stroke-width="1.5" fill="none"/>
<text x="50" y="78" text-anchor="middle" font-size="6" fill="#333">Ï‰</text>
<ellipse cx="31" cy="60" rx="5" ry="3" fill="#ffb3b3" opacity="0.45"/>
<ellipse cx="69" cy="60" rx="5" ry="3" fill="#ffb3b3" opacity="0.45"/>
</svg>`,
// 8 ç”„è¿ªå¸… - ç”·ï¼Œé£æœºå¤´ï¼Œå¢¨é•œï¼Œé…·
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#636e72"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#e8b48a"/>
<path d="M26 44 Q26 16 50 10 Q74 16 74 44 L71 34 Q68 20 50 18 Q32 20 29 34Z" fill="#1a1a2e"/>
<path d="M40 18 Q50 4 60 18" fill="#1a1a2e"/>
<path d="M30 48 L46 48 L44 54 L32 54Z" fill="#1a1a2e" opacity="0.85"/>
<path d="M54 48 L70 48 L68 54 L56 54Z" fill="#1a1a2e" opacity="0.85"/>
<line x1="46" y1="50" x2="54" y2="50" stroke="#1a1a2e" stroke-width="2"/>
<path d="M43 68 Q50 73 57 68" stroke="#333" stroke-width="2" fill="none"/>
</svg>`,
// 9 å‘¨æ˜Ÿæ˜Ÿ - ç”·ï¼Œçˆ†ç‚¸å¤´ï¼Œæç¬‘ï¼Œé¾…ç‰™
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#ffeaa7"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#fddcb5"/>
<path d="M18 50 Q15 10 50 6 Q85 10 82 50 Q78 20 50 16 Q22 20 18 50Z" fill="#2c1810"/>
<circle cx="30" cy="22" r="8" fill="#2c1810"/>
<circle cx="70" cy="22" r="8" fill="#2c1810"/>
<circle cx="50" cy="10" r="9" fill="#2c1810"/>
<circle cx="22" cy="36" r="7" fill="#2c1810"/>
<circle cx="78" cy="36" r="7" fill="#2c1810"/>
<circle cx="38" cy="50" r="4" fill="#fff"/><circle cx="62" cy="50" r="4" fill="#fff"/>
<circle cx="38" cy="50" r="2.5" fill="#333"/><circle cx="62" cy="50" r="2.5" fill="#333"/>
<circle cx="39" cy="49" r="1" fill="#fff"/><circle cx="63" cy="49" r="1" fill="#fff"/>
<path d="M36 44 Q38 42 42 44" stroke="#2c1810" stroke-width="2" fill="none"/>
<path d="M58 44 Q62 42 64 44" stroke="#2c1810" stroke-width="2" fill="none"/>
<path d="M42 66 Q50 76 58 66" stroke="#333" stroke-width="2" fill="#ff9999"/>
<rect x="46" y="66" width="3.5" height="5" rx="0.5" fill="#fff"/>
<rect x="50.5" y="66" width="3.5" height="5" rx="0.5" fill="#fff"/>
</svg>`,
// 10 åˆ˜åä»” - ç”·ï¼ŒèƒŒå¤´ï¼Œæˆç†Ÿï¼Œç»œè…®èƒ¡
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#2d3436"/>
<ellipse cx="50" cy="62" rx="28" ry="30" fill="#d4956b"/>
<path d="M24 42 Q26 12 50 9 Q74 12 76 42 L73 30 Q70 16 50 14 Q30 16 27 30Z" fill="#1a1a2e"/>
<path d="M76 42 Q78 38 76 34" stroke="#1a1a2e" stroke-width="3" fill="none"/>
<circle cx="38" cy="50" r="2.8" fill="#1a1a2e"/><circle cx="62" cy="50" r="2.8" fill="#1a1a2e"/>
<circle cx="39" cy="49" r="0.8" fill="#fff"/><circle cx="63" cy="49" r="0.8" fill="#fff"/>
<path d="M34 45 L42 44" stroke="#1a1a2e" stroke-width="2.5" stroke-linecap="round"/>
<path d="M58 44 L66 45" stroke="#1a1a2e" stroke-width="2.5" stroke-linecap="round"/>
<path d="M36 72 Q42 68 50 70 Q58 68 64 72" stroke="#3d2b1f" stroke-width="2" fill="none"/>
<path d="M32 66 Q34 74 38 76 Q42 74 44 66" stroke="#3d2b1f" stroke-width="1.2" fill="none" opacity="0.5"/>
<path d="M56 66 Q58 74 62 76 Q66 74 68 66" stroke="#3d2b1f" stroke-width="1.2" fill="none" opacity="0.5"/>
<path d="M44 68 Q50 73 56 68" stroke="#333" stroke-width="2" fill="none"/>
</svg>`,
// 11 è’‹ä¸é€š - ç”·ï¼Œå…‰å¤´ï¼Œåœ†è„¸ï¼Œæ†¨åšç¬‘
`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="50" fill="#55efc4"/>
<ellipse cx="50" cy="58" rx="32" ry="34" fill="#fddcb5"/>
<ellipse cx="50" cy="30" rx="30" ry="8" fill="#f0d0a0" opacity="0.3"/>
<circle cx="36" cy="50" r="3" fill="#333"/><circle cx="64" cy="50" r="3" fill="#333"/>
<circle cx="37" cy="49" r="1" fill="#fff"/><circle cx="65" cy="49" r="1" fill="#fff"/>
<path d="M33 45 Q36 43 40 45" stroke="#a08060" stroke-width="2" fill="none"/>
<path d="M60 45 Q64 43 67 45" stroke="#a08060" stroke-width="2" fill="none"/>
<path d="M40 66 Q50 78 60 66" stroke="#333" stroke-width="2.2" fill="#ff9999"/>
<ellipse cx="30" cy="58" rx="6" ry="4" fill="#ffb3b3" opacity="0.4"/>
<ellipse cx="70" cy="58" rx="6" ry="4" fill="#ffb3b3" opacity="0.4"/>
</svg>`
];
const POS=['A1','B1','C1','A2','B2','C2','A3','B3','C3','A4','B4','C4'];
const ROLE_INFO={wolf:{label:'ç‹¼äºº',cls:'role-wolf'},guard:{label:'å®ˆå«',cls:'role-guard'},witch:{label:'å·«å¸ˆ',cls:'role-witch'},seer:{label:'é¢„è¨€å®¶',cls:'role-seer'},villager:{label:'æ‘æ°‘',cls:'role-villager'}};

let players=[],selected=null,gameOver=false;

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function rnd(a){return a[Math.floor(Math.random()*a.length)]}
function rc(i){return{r:Math.floor(i/3),c:i%3}}
function idx(r,c){return(r>=0&&r<4&&c>=0&&c<3)?r*3+c:-1}
function neighbors(i){const{r,c}=rc(i);const ns=[];for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(!dr&&!dc)continue;const j=idx(r+dr,c+dc);if(j>=0)ns.push(j)}return ns}
function sameRow(i){const{r}=rc(i);return[0,1,2].map(c=>idx(r,c)).filter(j=>j!==i)}
function sameCol(i){const{c}=rc(i);return[0,1,2,3].map(r=>idx(r,c)).filter(j=>j!==i)}

function genClue(i){
  const p=players[i],isWolf=p.role==='wolf';
  const nbs=neighbors(i),row=sameRow(i),col=sameCol(i);
  const nbWolves=nbs.filter(j=>players[j].role==='wolf').length;
  const{r,c}=rc(i);
  const dirs=[[0,-1,'å·¦è¾¹'],[0,1,'å³è¾¹'],[-1,0,'ä¸Šé¢'],[1,0,'ä¸‹é¢']];
  let clues=[];

  // å‘¨å›´ç‹¼äººæ•°
  clues.push({t:'æˆ‘çš„å‘¨å›´æ²¡æœ‰ç‹¼äºº',v:nbWolves===0});
  if(nbWolves>0)clues.push({t:'æˆ‘çš„å‘¨å›´æœ‰'+nbWolves+'åªç‹¼',v:true});

  // æ–¹å‘
  for(const[dr,dc,lb]of dirs){
    const j=idx(r+dr,c+dc);
    if(j>=0){
      clues.push({t:'æˆ‘'+lb+'çš„äººæ˜¯å¥½äºº',v:players[j].role!=='wolf'});
      clues.push({t:'æˆ‘'+lb+'çš„äººæ˜¯ç‹¼äºº',v:players[j].role==='wolf'});
    }
  }

  // æŒ‡å
  const others=[...new Set([...nbs,...row,...col])];
  shuffle(others);
  for(let k=0;k<Math.min(2,others.length);k++){
    const j=others[k];
    clues.push({t:players[j].name+'æ˜¯å¥½äºº',v:players[j].role!=='wolf'});
    clues.push({t:players[j].name+'æ˜¯ç‹¼äºº',v:players[j].role==='wolf'});
  }

  // èº«ä»½ç›¸å…³
  const specials=['guard','witch','seer'];
  for(const s of specials){
    const sp=players.find(x=>x.role===s||x.disguise===s);
    if(sp){
      clues.push({t:ROLE_INFO[s].label+'æ˜¯æœ€å–„è‰¯çš„äºº',v:sp.role!=='wolf'});
      if(players.some(x=>x.role==='wolf'&&x.disguise===s))
        clues.push({t:'æœ‰1åŒ¹ç‹¼ç©¿ä¸Šäº†'+ROLE_INFO[s].label+'çš„è¡£æœ',v:true});
    }
  }

  // è‡ªè¯
  clues.push({t:'ç›¸ä¿¡æˆ‘ï¼Œæˆ‘æ˜¯å¥½äºº',v:!isWolf});
  clues.push({t:'æˆ‘å‘èª“æˆ‘ä¸æ˜¯ç‹¼äºº',v:!isWolf});

  // å¥½äººé€‰çœŸè¯ï¼Œç‹¼äººé€‰å‡è¯
  const pool=clues.filter(c=>isWolf?!c.v:c.v);
  return pool.length?rnd(pool).t:'æˆ‘æ²¡ä»€ä¹ˆæƒ³è¯´çš„';
}

function initGame(){
  players=[];selected=null;gameOver=false;
  document.getElementById('result').innerHTML='';
  document.getElementById('conclusion').textContent='';
  document.getElementById('voteBtn').disabled=true;

  // åˆ†é…èº«ä»½
  const roles=['wolf','wolf','wolf','guard','witch','seer','villager','villager','villager','villager','villager','villager'];
  shuffle(roles);

  // ç‹¼äººä¼ªè£…ï¼ˆ30%æ¦‚ç‡ä¸€åªç‹¼ä¼ªè£…ç‰¹æ®Šèº«ä»½ï¼‰
  const wolfIdxs=roles.map((r,i)=>r==='wolf'?i:-1).filter(i=>i>=0);
  let disguises={};
  if(Math.random()<0.3){
    const fakeRole=rnd(['guard','witch','seer']);
    disguises[rnd(wolfIdxs)]=fakeRole;
  }

  for(let i=0;i<12;i++){
    players.push({
      name:NAMES[i],avatar:AVATARS[i],role:roles[i],
      disguise:disguises[i]||null,clue:''
    });
  }
  // ç”Ÿæˆçº¿ç´¢
  for(let i=0;i<12;i++)players[i].clue=genClue(i);

  // æ¸²æŸ“ä¿¡æ¯æ 
  const wolfCount=players.filter(p=>p.role==='wolf').length;
  document.getElementById('infoBar').innerHTML=
    `<span>ğŸº ç‹¼äºº Ã—${wolfCount}</span><span>ğŸ‘¥ å¥½äºº Ã—${12-wolfCount}</span><span>ğŸ’¡ ç¿»å¼€å¡ç‰‡æŸ¥çœ‹çº¿ç´¢</span>`;

  renderGrid();
}

function renderGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  for(let i=0;i<12;i++){
    const p=players[i];
    const displayRole=p.disguise||p.role;
    const ri=ROLE_INFO[displayRole]||ROLE_INFO.villager;
    const card=document.createElement('div');
    card.className='card'+(selected===i?' selected':'');
    card.innerHTML=`
      <span class="pos">${POS[i]}</span>
      <div class="card-inner">
        <div class="card-front">
          <div class="ava">${p.avatar}</div>
          <div class="nm">${p.name}</div>
        </div>
        <div class="card-back">
          <div class="ava">${p.avatar}</div>
          <div class="nm">${p.name}</div>
          <span class="role-tag ${ri.cls}">${ri.label}</span>
          <div class="clue">"${p.clue}"</div>
        </div>
      </div>`;
    card.onclick=()=>clickCard(i,card);
    grid.appendChild(card);
  }
}

function clickCard(i,el){
  if(gameOver)return;
  el.classList.toggle('flipped');
  // é•¿æŒ‰é€‰ä¸­æŠ•ç¥¨
}

// æ·»åŠ é•¿æŒ‰/åŒå‡»é€‰ä¸­
document.getElementById('grid').addEventListener('dblclick',function(e){
  if(gameOver)return;
  const card=e.target.closest('.card');
  if(!card)return;
  const i=[...card.parentNode.children].indexOf(card);
  if(selected===i){selected=null}
  else{selected=i}
  document.querySelectorAll('.card').forEach((c,idx)=>c.classList.toggle('selected',idx===selected));
  document.getElementById('voteBtn').disabled=selected===null;
});

function vote(){
  if(selected===null||gameOver)return;
  gameOver=true;
  const p=players[selected];
  const res=document.getElementById('result');
  // ç¿»å¼€æ‰€æœ‰å¡ç‰‡
  document.querySelectorAll('.card').forEach(c=>c.classList.add('flipped'));
  if(p.role==='wolf'){
    res.innerHTML=`<span class="win">ğŸ‰ æ­£ç¡®ï¼${p.name} æ˜¯ç‹¼äººï¼ä½ èµ¢äº†ï¼</span>`;
  }else{
    const wolves=players.filter(x=>x.role==='wolf').map(x=>x.name).join('ã€');
    res.innerHTML=`<span class="lose">ğŸ’€ é”™äº†ï¼${p.name} æ˜¯å¥½äºº... ç‹¼äººæ˜¯ï¼š${wolves}</span>`;
  }
}

function newGame(){initGame()}
initGame();
</script>
</body>
</html>
